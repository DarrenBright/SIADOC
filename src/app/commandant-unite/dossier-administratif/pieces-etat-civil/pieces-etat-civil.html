<h2>PiÃ¨ces dâ€™Ã©tat civil</h2>

<!-- LISTE DES PIÃˆCES -->
<div class="card">

  <div class="card-header">
    <span>ðŸ“„ PiÃ¨ces enregistrÃ©es</span>
    <button class="btn-primary" (click)="ouvrirFormulaire()">
      âž• Ajouter une piÃ¨ce
    </button>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>Nom</th>
        <th>PrÃ©nom</th>
        <th>Type</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of pieces">
        <td>{{ p.nom }}</td>
        <td>{{ p.prenom }}</td>
        <td>{{ p.type }}</td>
        <td>{{ p.dateEnregistrement }}</td>
        <td>
          <span *ngIf="p.fichier">ðŸ“Ž</span>
          <span *ngIf="!p.fichier">â€”</span>
        </td>
        <td class="actions">
          <button class="btn-view" (click)="voirPiece(p)">Voir</button>
          <button class="btn-edit" (click)="modifierPiece(p)">Modifier</button>
          <button class="btn-delete" (click)="supprimerPiece(p)">Supprimer</button>
        </td>
      </tr>
    </tbody>
  </table>

</div>
<div *ngIf="pieceSelectionnee" class="card form-card">

  <h3>Consultation de la piÃ¨ce</h3>

  <p><strong>Nom :</strong> {{ pieceSelectionnee.nom }}</p>
  <p><strong>PrÃ©nom :</strong> {{ pieceSelectionnee.prenom }}</p>
  <p><strong>Type :</strong> {{ pieceSelectionnee.type }}</p>
  <p><strong>Date dâ€™enregistrement :</strong> {{ pieceSelectionnee.dateEnregistrement }}</p>

  <div *ngIf="pieceSelectionnee.type === 'CNI'">
    <p><strong>Date dÃ©livrance :</strong> {{ pieceSelectionnee.dateDelivrance }}</p>
    <p><strong>Date expiration :</strong> {{ pieceSelectionnee.dateExpiration }}</p>
  </div>

  <hr>

  <!-- AFFICHAGE DU DOCUMENT -->
  <h3>Document scannÃ©</h3>
  <div class="preview-box">

  <!-- IMAGE -->
  <img
    *ngIf="pieceSelectionnee?.fichierUrl && isImage(pieceSelectionnee.fichier)"
    [src]="pieceSelectionnee.fichierUrl"
    alt="Document"
  />

  <!-- PDF -->
  <iframe
    *ngIf="pieceSelectionnee?.fichierUrl && isPdf(pieceSelectionnee.fichier)"
    [src]="pieceSelectionnee.fichierUrl"
  ></iframe>

  </div>

  <div class="form-actions">
    <button (click)="fermerApercu()">Fermer</button>
  </div>

</div>


<!-- FORMULAIRE D'AJOUT / MODIFICATION -->
<div *ngIf="afficherFormulaire" class="card form-card">

  <h3>Ajouter une piÃ¨ce dâ€™Ã©tat civil</h3>

  <div class="form-grid">

    <!-- IDENTITÃ‰ -->
    <div class="form-group">
      <label>Nom *</label>
      <input type="text" [(ngModel)]="pieceForm.nom" required>
    </div>

    <div class="form-group">
      <label>PrÃ©nom *</label>
      <input type="text" [(ngModel)]="pieceForm.prenom" required>
    </div>

    <!-- TYPE DE PIÃˆCE -->
    <div class="form-group">
      <label>Type de piÃ¨ce *</label>
      <select [(ngModel)]="pieceForm.type" required>
        <option value="">-- SÃ©lectionner --</option>
        <option>Acte de naissance</option>
        <option>Acte de mariage</option>
        <option>Jugement supplÃ©tif</option>
        <option>CNI</option>
      </select>
    </div>

    <div class="form-group">
      <label>Date dâ€™Ã©tablissement</label>
      <input type="date" [(ngModel)]="pieceForm.dateEtablissement">
    </div>

    <!-- CAS PARTICULIER : CNI -->
    <div *ngIf="pieceForm.type === 'CNI'" class="form-group">
      <label>Date de dÃ©livrance *</label>
      <input type="date" [(ngModel)]="pieceForm.dateDelivrance">
    </div>

    <div *ngIf="pieceForm.type === 'CNI'" class="form-group">
      <label>Date dâ€™expiration *</label>
      <input type="date" [(ngModel)]="pieceForm.dateExpiration">
    </div>

    <!-- OBSERVATION -->
    <div class="form-group full-width">
      <label>Observations</label>
      <textarea rows="3" [(ngModel)]="pieceForm.observation"></textarea>
    </div>

    <!-- FICHIER -->
    <div class="form-group full-width">
      <label>Document scannÃ©</label>
      <input
        type="file"
        (change)="onFileSelected($event)"
        accept=".pdf,.jpg,.jpeg,.png"
      />

      <small *ngIf="pieceForm.fichier">
        ðŸ“Ž {{ pieceForm.fichier.name }}
      </small>
    </div>

  </div>

  <div class="form-actions">
    <button class="btn-success" (click)="enregistrerPiece()">ðŸ’¾ Enregistrer</button>
    <button class="btn-cancel" (click)="fermerFormulaire()">Annuler</button>
  </div>

</div>
